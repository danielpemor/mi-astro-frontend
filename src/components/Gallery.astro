---
// src/components/Gallery.astro
import { getGalleryImages, getAssetUrl } from '../lib/directus';

const images = await getGalleryImages();

// Debug: imprimir URLs para verificar
console.log('Gallery images:', images.map(img => ({
  id: img.id,
  imageId: img.image,
  url: getAssetUrl(img.image)
})));
---

<section class="py-20 bg-gray-50">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Nuestra Galería</h2>
    
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      {images.map((image, index) => (
        <div class={`gallery-item overflow-hidden rounded-lg shadow-md ${
          index === 0 ? 'col-span-2 row-span-2' : ''
        }`}>
          <img 
            src={getAssetUrl(image.image, { width: 800, height: 600 })} 
            alt={image.alt_text || 'Imagen de galería'} 
            class="w-full h-full object-cover transition-transform hover:scale-110 duration-500"
            loading={index < 4 ? 'eager' : 'lazy'}
            onError="this.src='/placeholder.jpg'"
          />
        </div>
      ))}
      
      {/* Imágenes de respaldo si no hay suficientes en Directus */}
      {images.length < 8 && Array.from({ length: Math.max(0, 8 - images.length) }).map((_, i) => (
        <div class="gallery-item overflow-hidden rounded-lg shadow-md">
          <img 
            src={`/gallery-${i + 1}.jpg`} 
            alt="Imagen de galería" 
            class="w-full h-full object-cover transition-transform hover:scale-110 duration-500"
            loading="lazy"
          />
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .gallery-item {
    aspect-ratio: 1 / 1;
    height: 100%;
  }
  
  .gallery-item:first-child {
    aspect-ratio: 2 / 2;
  }
  
  @media (min-width: 768px) {
    .gallery-item:first-child {
      grid-row: span 2;
      grid-column: span 2;
    }
  }
  
  .gallery-item img {
    transition: transform 0.3s ease;
  }
  
  .gallery-item:hover img {
    transform: scale(1.05);
  }
</style>